<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Well-Architected Evidence Pack ‚Äî {{ metadata.account_id }}</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700;800&display=swap" rel="stylesheet">
  <script>
    (function(){var k='ecad-theme';var v=null;try{v=localStorage.getItem(k);}catch(e){}if(!v&&typeof window.matchMedia!=='undefined'&&window.matchMedia('(prefers-color-scheme: light)').matches)v='light';document.documentElement.setAttribute('data-theme',v||'dark');})();
  </script>
  <style>
    /* Dark theme (default) */
    :root, [data-theme="dark"] {
      --bg: #09090b;
      --surface: #18181b;
      --surface-hover: #27272a;
      --border: rgba(255,255,255,.08);
      --text: #fafafa;
      --text-muted: #a1a1aa;
      --accent: #06b6d4;
      --accent-fg: #09090b;
      --accent-dim: rgba(6, 182, 212, .25);
      --success: #22c55e;
      --success-dim: rgba(34, 197, 94, .2);
      --warning: #f59e0b;
      --warning-dim: rgba(245, 158, 11, .2);
      --danger: #ef4444;
      --danger-dim: rgba(239, 68, 68, .2);
      --info: #71717a;
      --info-dim: rgba(113, 113, 122, .2);
      --radius: 14px;
      --radius-lg: 20px;
      --radius-xl: 28px;
      --ease: cubic-bezier(0.4, 0, 0.2, 1);
      --transition: 0.3s var(--ease);
    }
    /* Light theme */
    [data-theme="light"] {
      --bg: #fafafa;
      --surface: #ffffff;
      --surface-hover: #f4f4f5;
      --border: rgba(0,0,0,.08);
      --text: #18181b;
      --text-muted: #71717a;
      --accent: #0891b2;
      --accent-fg: #ffffff;
      --accent-dim: rgba(8, 145, 178, .2);
      --success: #16a34a;
      --warning: #d97706;
      --danger: #dc2626;
      --info: #52525b;
    }
    [data-theme="light"] body {
      background-image: radial-gradient(ellipse at 50% 0%, rgba(0,0,0,.03) 0%, transparent 50%), linear-gradient(180deg, transparent 0%, var(--bg) 100%);
    }
    [data-theme="light"] .hero::before {
      background: radial-gradient(ellipse 80% 50% at 50% -20%, rgba(8, 145, 178, .12), transparent 50%),
        radial-gradient(ellipse 60% 40% at 80% 50%, rgba(99, 102, 241, .08), transparent 45%),
        radial-gradient(ellipse 50% 30% at 20% 80%, rgba(8, 145, 178, .06), transparent 40%);
    }
    [data-theme="light"] .hero h1 {
      background: linear-gradient(180deg, #18181b 0%, rgba(24,24,27,.9) 100%);
      -webkit-background-clip: text;
      background-clip: text;
    }
    [data-theme="light"] .scorecard-hero .score-big {
      background: linear-gradient(180deg, #18181b 0%, rgba(24,24,27,.85) 100%);
      -webkit-background-clip: text;
      background-clip: text;
    }
    [data-theme="light"] .tabs-wrap .tab-labels label:hover { border-color: rgba(0,0,0,.15); }
    [data-theme="light"] .tab-report-content tr:nth-child(even) { background: rgba(0,0,0,.02); }
    * { box-sizing: border-box; }
    html { scroll-behavior: smooth; }
    body {
      margin: 0;
      font-family: 'Plus Jakarta Sans', -apple-system, BlinkMacSystemFont, sans-serif;
      background: var(--bg);
      background-image:
        radial-gradient(ellipse at 50% 0%, rgba(255,255,255,.03) 0%, transparent 50%),
        linear-gradient(180deg, transparent 0%, var(--bg) 100%);
      color: var(--text);
      line-height: 1.6;
      font-size: 16px;
      -webkit-font-smoothing: antialiased;
      min-height: 100vh;
    }
    .container { max-width: 1000px; margin: 0 auto; padding: 0 28px; }
    .hero {
      position: relative;
      padding: 72px 0 64px;
      overflow: hidden;
    }
    .hero::before {
      content: "";
      position: absolute;
      inset: 0;
      background:
        radial-gradient(ellipse 80% 50% at 50% -20%, rgba(6, 182, 212, .18), transparent 50%),
        radial-gradient(ellipse 60% 40% at 80% 50%, rgba(99, 102, 241, .12), transparent 45%),
        radial-gradient(ellipse 50% 30% at 20% 80%, rgba(6, 182, 212, .08), transparent 40%);
      pointer-events: none;
    }
    .hero .container { position: relative; z-index: 1; }
    .hero .label {
      display: inline-block;
      font-size: 12px;
      font-weight: 600;
      letter-spacing: 0.12em;
      text-transform: uppercase;
      color: var(--accent);
      margin-bottom: 16px;
    }
    .hero h1 {
      margin: 0 0 12px;
      font-size: clamp(36px, 5vw, 52px);
      font-weight: 800;
      letter-spacing: -0.03em;
      line-height: 1.1;
      background: linear-gradient(180deg, #fff 0%, rgba(255,255,255,.85) 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }
    .hero .meta {
      font-size: 15px;
      color: var(--text-muted);
      margin-bottom: 48px;
    }
    .hero .meta span + span::before { content: " ¬∑ "; }
    .hero .container { position: relative; }
    .theme-toggle {
      position: absolute;
      top: 0;
      right: 0;
      width: 44px;
      height: 44px;
      border-radius: 50%;
      border: 1px solid var(--border);
      background: var(--surface);
      color: var(--text-muted);
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all var(--transition);
      font-size: 20px;
    }
    .theme-toggle:hover { color: var(--text); border-color: var(--accent); background: var(--surface-hover); }
    [data-theme="light"] .theme-toggle .icon-dark { display: none; }
    [data-theme="light"] .theme-toggle .icon-light { display: inline; }
    .theme-toggle .icon-light { display: none; }
    .theme-toggle .icon-dark { display: inline; }
    .pillar-cards {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(160px, 1fr));
      gap: 16px;
    }
    .pillar-card {
      position: relative;
      display: block;
      background: var(--surface);
      border-radius: var(--radius-lg);
      padding: 16px 16px;
      text-decoration: none;
      color: inherit;
      border: 1px solid var(--border);
      transition: transform var(--transition), box-shadow var(--transition), border-color var(--transition);
      overflow: hidden;
    }
    .pillar-card::before {
      content: "";
      position: absolute;
      inset: 0;
      border-radius: inherit;
      padding: 1px;
      background: linear-gradient(135deg, var(--pillar-color), transparent 50%);
      -webkit-mask: linear-gradient(#fff 0 0) content-box, linear-gradient(#fff 0 0);
      mask: linear-gradient(#fff 0 0) content-box, linear-gradient(#fff 0 0);
      -webkit-mask-composite: xor;
      mask-composite: exclude;
      opacity: .6;
      transition: opacity var(--transition);
    }
    .pillar-card:hover {
      transform: translateY(-4px);
      border-color: var(--pillar-color);
      box-shadow: 0 20px 40px -12px rgba(0,0,0,.5), 0 0 0 1px var(--pillar-color);
    }
    .pillar-card:hover::before { opacity: 1; }
    .pillar-card .name {
      font-weight: 700;
      font-size: 15px;
      margin-bottom: 8px;
      letter-spacing: -0.02em;
    }
    .pillar-card .badge {
      display: inline-block;
      font-size: 11px;
      font-weight: 600;
      padding: 5px 12px;
      border-radius: 100px;
      margin-bottom: 10px;
      letter-spacing: 0.02em;
    }
    .badge-success { background: var(--success-dim); color: #4ade80; }
    .badge-warning { background: var(--warning-dim); color: #fbbf24; }
    .badge-danger { background: var(--danger-dim); color: #f87171; }
    .badge-info { background: var(--info-dim); color: #a1a1aa; }
    .pillar-card .summary {
      font-size: 13px;
      color: var(--text-muted);
      line-height: 1.4;
      display: -webkit-box;
      -webkit-line-clamp: 2;
      -webkit-box-orient: vertical;
      overflow: hidden;
    }
    .pillar-hero-icon {
      width: 44px;
      height: 44px;
      margin-bottom: 12px;
      color: var(--pillar-color);
      flex-shrink: 0;
    }
    .pillar-hero-icon svg { width: 100%; height: 100%; display: block; }
    .pillar-section-icon {
      width: 72px;
      height: 72px;
      margin-bottom: 20px;
      color: var(--pillar-color);
    }
    .pillar-section-icon svg { width: 100%; height: 100%; display: block; }
    .nav-pillars {
      position: sticky;
      top: 0;
      z-index: 100;
      background: rgba(9, 9, 11, .8);
      backdrop-filter: saturate(180%) blur(24px);
      -webkit-backdrop-filter: saturate(180%) blur(24px);
      border-bottom: 1px solid var(--border);
      padding: 14px 0;
    }
    .nav-pillars .container { display: flex; flex-wrap: wrap; gap: 10px; align-items: center; }
    .nav-pillars a {
      padding: 10px 18px;
      border-radius: 100px;
      text-decoration: none;
      font-size: 14px;
      font-weight: 600;
      color: var(--text-muted);
      border: 1px solid var(--border);
      transition: all var(--transition);
    }
    .nav-pillars a:hover {
      color: var(--text);
      border-color: var(--pillar-color);
      background: rgba(255,255,255,.03);
    }
    .nav-pillars a[data-color] { border-color: var(--pillar-color); color: var(--pillar-color); }
    .nav-pillars a[data-color]:hover { background: var(--pillar-color); color: var(--bg); }
    main { padding: 48px 0 100px; }
    .section-pillar {
      margin-bottom: 56px;
      background: var(--surface);
      border-radius: var(--radius-xl);
      padding: 40px 36px;
      border: 1px solid var(--border);
      border-top: 3px solid var(--pillar-color);
      box-shadow: 0 4px 24px -4px rgba(0,0,0,.3);
    }
    .section-pillar h2 {
      margin: 0 0 10px;
      font-size: 28px;
      font-weight: 800;
      letter-spacing: -0.03em;
      color: var(--text);
    }
    .section-pillar .pillar-summary {
      color: var(--text-muted);
      margin-bottom: 32px;
      font-size: 16px;
      line-height: 1.6;
    }
    .accordion { margin-top: 12px; }
    .accordion details {
      border: 1px solid var(--border);
      border-radius: var(--radius);
      margin-bottom: 12px;
      overflow: hidden;
      background: rgba(255,255,255,.02);
      transition: border-color var(--transition), box-shadow var(--transition);
    }
    .accordion details:hover { border-color: rgba(255,255,255,.12); }
    .accordion details[open] {
      border-color: var(--pillar-color);
      box-shadow: 0 0 0 1px var(--pillar-color), 0 8px 24px -8px rgba(0,0,0,.4);
    }
    .accordion summary {
      padding: 20px 24px;
      font-weight: 600;
      cursor: pointer;
      list-style: none;
      display: flex;
      align-items: center;
      gap: 14px;
      flex-wrap: wrap;
      font-size: 16px;
      transition: background var(--transition);
    }
    .accordion summary:hover { background: rgba(255,255,255,.04); }
    .accordion summary::-webkit-details-marker { display: none; }
    .accordion summary::after {
      content: "";
      width: 12px; height: 12px;
      margin-left: auto;
      border-right: 2px solid var(--text-muted);
      border-bottom: 2px solid var(--text-muted);
      transform: rotate(45deg);
      transition: transform var(--transition);
    }
    .accordion details[open] summary::after { transform: rotate(-135deg); }
    .accordion .q-id {
      font-size: 12px;
      font-weight: 700;
      color: var(--pillar-color);
      flex-shrink: 0;
      letter-spacing: 0.04em;
    }
    .accordion .content {
      padding: 0 24px 24px;
      border-top: 1px solid var(--border);
    }
    .accordion .compliance-msg {
      margin: 18px 0 14px;
      padding: 18px 22px;
      border-radius: 12px;
      font-size: 15px;
      line-height: 1.5;
    }
    .accordion .compliance-msg.status-compliant { background: var(--success-dim); color: #86efac; border: 1px solid rgba(34, 197, 94, .3); }
    .accordion .compliance-msg.status-partial { background: var(--warning-dim); color: #fcd34d; border: 1px solid rgba(245, 158, 11, .3); }
    .accordion .compliance-msg.status-not-compliant { background: var(--danger-dim); color: #fca5a5; border: 1px solid rgba(239, 68, 68, .3); }
    .accordion .compliance-msg.status-na { background: var(--info-dim); color: #d4d4d8; border: 1px solid rgba(113, 113, 122, .3); }
    .accordion ul.evidences, .accordion ul.practices { margin: 12px 0; padding-left: 22px; }
    .accordion ul.evidences li { margin: 8px 0; font-size: 15px; line-height: 1.5; }
    .accordion .servicios-list { margin: 8px 0; font-size: 14px; line-height: 1.5; color: var(--text-muted); }
    .accordion .servicios-list.missing { color: var(--danger); }
    .accordion .ev-ok { color: #4ade80; }
    .accordion .ev-warn { color: #fbbf24; }
    .accordion .ev-fail { color: #f87171; }
    .accordion .ev-info { color: #a1a1aa; }
    .accordion .practices { font-size: 15px; color: var(--text-muted); line-height: 1.55; }
    .accordion p strong {
      font-size: 12px;
      text-transform: uppercase;
      letter-spacing: 0.08em;
      color: var(--text-muted);
      font-weight: 600;
    }
    .footer {
      text-align: center;
      padding: 40px 28px;
      color: var(--text-muted);
      font-size: 13px;
      border-top: 1px solid var(--border);
    }
    .tabs-wrap { margin: 0 0 32px; }
    .tabs-wrap .tab-labels {
      display: flex;
      gap: 8px;
      padding: 0 28px;
      max-width: 1000px;
      margin: 0 auto 24px;
    }
    .tabs-wrap .tab-labels {
      flex-wrap: wrap;
      justify-content: center;
      gap: 10px;
    }
    .tabs-wrap .tab-labels label {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      text-align: center;
      min-height: 44px;
      padding: 10px 20px;
      border-radius: 100px;
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      border: 1px solid var(--border);
      color: var(--text-muted);
      transition: all var(--transition);
      line-height: 1.3;
      white-space: normal;
      word-break: break-word;
    }
    .tabs-wrap .tab-labels label:hover { color: var(--text); border-color: rgba(255,255,255,.2); }
    .tabs-wrap input[name="main-tab"] { display: none; }
    .tabs-wrap input#tab-scorecard:checked ~ .tab-labels label[for="tab-scorecard"],
    .tabs-wrap input#tab-evidence:checked ~ .tab-labels label[for="tab-evidence"],
    .tabs-wrap input#tab-caf:checked ~ .tab-labels label[for="tab-caf"],
    .tabs-wrap input#tab-maturity:checked ~ .tab-labels label[for="tab-maturity"],
    .tabs-wrap input#tab-executive:checked ~ .tab-labels label[for="tab-executive"],
    .tabs-wrap input#tab-findings:checked ~ .tab-labels label[for="tab-findings"],
    .tabs-wrap input#tab-improvement-plan:checked ~ .tab-labels label[for="tab-improvement-plan"],
    .tabs-wrap input#tab-tagging:checked ~ .tab-labels label[for="tab-tagging"] {
      background: var(--accent);
      border-color: var(--accent);
      color: var(--accent-fg);
    }
    .tabs-wrap .tab-panel { display: none; }
    .tabs-wrap input#tab-scorecard:checked ~ .tab-panel#panel-scorecard,
    .tabs-wrap input#tab-evidence:checked ~ .tab-panel#panel-evidence,
    .tabs-wrap input#tab-caf:checked ~ .tab-panel#panel-caf,
    .tabs-wrap input#tab-maturity:checked ~ .tab-panel#panel-maturity,
    .tabs-wrap input#tab-executive:checked ~ .tab-panel#panel-executive,
    .tabs-wrap input#tab-findings:checked ~ .tab-panel#panel-findings,
    .tabs-wrap input#tab-improvement-plan:checked ~ .tab-panel#panel-improvement-plan,
    .tabs-wrap input#tab-tagging:checked ~ .tab-panel#panel-tagging { display: block; }
    .tab-report-content {
      max-width: 1000px;
      margin: 0 auto;
      padding: 32px 28px 48px;
    }
    .tab-report-content h1,.tab-report-content h2,.tab-report-content h3 { margin: 1.25em 0 0.5em; color: var(--text); }
    .tab-report-content p { margin: 0.75em 0; }
    .tab-report-content ul, .tab-report-content ol { margin: 0.75em 0; padding-left: 1.5em; }
    .tab-report-content pre { background: var(--surface); padding: 1rem; border-radius: var(--radius); overflow-x: auto; font-size: 14px; }
    .tab-report-placeholder { color: var(--text-muted); text-align: center; padding: 48px 28px; }
    .tab-report-placeholder p { margin: 0.5em 0; }
    .tab-report-content table { width: 100%; border-collapse: collapse; margin: 1em 0; font-size: 14px; }
    .tab-report-content th, .tab-report-content td { border: 1px solid var(--border); padding: 10px 14px; text-align: left; }
    .tab-report-content th { background: var(--surface); color: var(--accent); font-weight: 600; }
    .tab-report-content tr:nth-child(even) { background: rgba(255,255,255,.02); }
    /* Estilos para Plan de mejoras por dificultad */
    #panel-improvement-plan .improvement-section {
      border-radius: var(--radius-lg);
      padding: 20px 24px;
      margin-bottom: 24px;
      border: 1px solid var(--border);
    }
    #panel-improvement-plan .improvement-pronta {
      border-left: 4px solid #22c55e; /* verde ‚Äì m√°s f√°cil / 30 d√≠as */
      background: rgba(34, 197, 94, 0.05);
    }
    #panel-improvement-plan .improvement-mri {
      border-left: 4px solid #f97316; /* naranja ‚Äì mayor complejidad */
      background: rgba(249, 115, 22, 0.05);
    }
    .scorecard-hero {
      text-align: center;
      padding: 40px 28px 32px;
    }
    .scorecard-hero .score-big {
      font-size: 64px;
      font-weight: 800;
      letter-spacing: -0.03em;
      line-height: 1;
      background: linear-gradient(180deg, #fff 0%, rgba(255,255,255,.8) 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }
    .scorecard-hero .score-big span { font-size: 28px; color: var(--text-muted); font-weight: 600; }
    .scorecard-hero .score-subtitle { color: var(--text-muted); margin-top: 8px; font-size: 15px; }
    .score-mode-toggle {
      margin-top: 16px;
      display: inline-flex;
      gap: 8px;
      padding: 6px;
      border: 1px solid var(--border);
      border-radius: 999px;
      background: var(--surface);
    }
    .score-mode-toggle button {
      border: 1px solid transparent;
      background: transparent;
      color: var(--text-muted);
      padding: 8px 14px;
      border-radius: 999px;
      font-size: 13px;
      font-weight: 600;
      cursor: pointer;
      transition: all var(--transition);
    }
    .score-mode-toggle button:hover {
      color: var(--text);
      border-color: var(--border);
    }
    .score-mode-toggle button.is-active {
      background: var(--accent);
      color: var(--accent-fg);
      border-color: var(--accent);
    }
    .score-mode-help {
      margin-top: 10px;
      font-size: 12px;
      color: var(--text-muted);
      text-align: center;
    }
    .scorecard-hero .score-formula {
      margin-top: 20px;
      padding: 16px 20px;
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      font-size: 13px;
      color: var(--text-muted);
      text-align: left;
      max-width: 560px;
      margin-left: auto;
      margin-right: auto;
    }
    .scorecard-hero .score-formula strong { color: var(--text); }
    .scorecard-hero .score-formula code { background: var(--surface-hover); padding: 2px 6px; border-radius: 4px; font-size: 12px; }
    .score-radar-wrap {
      margin-top: 32px;
      text-align: center;
    }
    .score-radar-wrap h2 {
      font-size: 18px;
      margin-bottom: 12px;
      letter-spacing: -0.02em;
    }
    .score-radar {
      display: inline-block;
      max-width: 320px;
      width: 100%;
    }
    .score-radar svg {
      width: 100%;
      height: auto;
      display: block;
    }
    .score-radar-grid {
      stroke: var(--border);
      stroke-width: 1;
      fill: none;
    }
    .score-radar-axis {
      stroke: var(--border);
      stroke-width: 1;
      stroke-dasharray: 2 3;
    }
    .score-radar-polygon {
      fill: var(--accent);
      fill-opacity: 0.12;
      stroke: var(--accent);
      stroke-width: 2;
      stroke-linejoin: round;
      stroke-dasharray: 4 3;
    }
    .score-radar-label {
      font-size: 11px;
      fill: var(--text-muted);
    }
    .scorecard-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
      gap: 20px;
      max-width: 1000px;
      margin: 0 auto;
      padding: 0 28px 48px;
    }
    .scorecard-card {
      background: var(--surface);
      border-radius: var(--radius-lg);
      padding: 24px;
      border: 1px solid var(--border);
      border-left: 4px solid var(--pillar-color);
    }
    .scorecard-card .name {
      font-weight: 700;
      font-size: 15px;
      line-height: 1.3;
      margin-bottom: 8px;
      word-break: break-word;
    }
    .scorecard-card .score-row { display: flex; align-items: center; gap: 12px; margin-bottom: 8px; }
    .scorecard-card .score-num { font-size: 28px; font-weight: 800; color: var(--pillar-color); }
    .scorecard-card .score-label { font-size: 14px; color: var(--text-muted); }
    .scorecard-card .summary { font-size: 14px; color: var(--text-muted); line-height: 1.5; }
    @media (max-width: 768px) {
      .hero { padding: 48px 0 44px; }
      .hero h1 { font-size: 32px; }
      .section-pillar { padding: 28px 24px; }
      .section-pillar h2 { font-size: 24px; }
    }
  </style>
</head>
<body>
  <header class="hero">
    <div class="container">
      <button type="button" class="theme-toggle" id="theme-toggle" title="Cambiar tema claro/oscuro" aria-label="Cambiar tema">
        <span class="icon-dark" aria-hidden="true">üåô</span>
        <span class="icon-light" aria-hidden="true">‚òÄÔ∏è</span>
      </button>
      <span class="label">Well-Architected Framework{% if metadata.well_arch_version %} ¬∑ v{{ metadata.well_arch_version }}{% endif %}</span>
      <h1>Evidence Pack</h1>
      <p class="meta">
        <span>Account {{ metadata.account_id }}</span>
        <span>{{ metadata.generated_at }}</span>
      </p>
    </div>
  </header>

  <div class="tabs-wrap">
    <input type="radio" name="main-tab" id="tab-scorecard" checked>
    <input type="radio" name="main-tab" id="tab-evidence">
    <input type="radio" name="main-tab" id="tab-caf">
    <input type="radio" name="main-tab" id="tab-maturity">
    <input type="radio" name="main-tab" id="tab-executive">
    <input type="radio" name="main-tab" id="tab-findings">
    <input type="radio" name="main-tab" id="tab-improvement-plan">
    <input type="radio" name="main-tab" id="tab-tagging">
    <div class="tab-labels">
      <label for="tab-scorecard">Scorecard</label>
      <label for="tab-evidence">Evidence Pack</label>
      <label for="tab-caf">CAF</label>
      <label for="tab-maturity">Modelo de Madurez</label>
      <label for="tab-tagging">Tags por servicio</label>
      <label for="tab-executive">Resumen ejecutivo</label>
      <label for="tab-findings">Hallazgos</label>
      <label for="tab-improvement-plan">Plan de mejoras</label>
    </div>
    <div id="panel-scorecard" class="tab-panel">
      <div class="scorecard-hero">
        <div class="score-big"><span id="overall-score">{{ average_score }}</span><span>/5.0</span></div>
        <p class="score-subtitle">Score promedio por pilar</p>
        <div class="score-mode-toggle" role="group" aria-label="Modo de scoring por ambiente">
          <button type="button" id="score-mode-standard">DLL / No productivo</button>
          <button type="button" id="score-mode-conservative" class="is-active">Productivo</button>
        </div>
        <p class="score-mode-help">Usa <strong>DLL / No productivo</strong> para ambientes de prueba y <strong>Productivo</strong> para cuentas en operaci√≥n real.</p>
        <div class="score-formula" id="score-formula-standard" style="display:none;">
          <strong>F√≥rmula de ponderaci√≥n (DLL / No productivo):</strong><br>
          Por pilar: <code>score_pilar = redondeo(media(puntos por pregunta))</code>, con puntos: compliant=5, partially_compliant=4, not_compliant=2 (not_applicable se excluye). L√≠mites 1‚Äì5.<br>
          Score global: <code>average_score = media(score_Operational Excellence, ‚Ä¶, score_Sustainability)</code> (promedio simple de los 6 pilares).
        </div>
        <div class="score-formula" id="score-formula-conservative">
          <strong>F√≥rmula de ponderaci√≥n (Productivo):</strong><br>
          Por pilar: <code>score_pilar = redondeo(score_preguntas - penalizaciones + bono)</code>.<br>
          Donde <code>score_preguntas = media(puntos por pregunta)</code>, con puntos: compliant=5, partially_compliant=3, not_compliant=1 (not_applicable se excluye).<br>
          Penalizaciones por evidencia: not_detected/service_missing=0.12, warning=0.20, negative|error=0.35 (tope 1.8). Bono positive=0.10 (tope 0.3). L√≠mites 1‚Äì5.<br>
          Score global: <code>average_score = media(score_Operational Excellence, ‚Ä¶, score_Sustainability)</code> (promedio simple de los 6 pilares).
        </div>
        <div class="score-radar-wrap">
          <h2>Radar de valores por pilar</h2>
          <div id="score-radar" class="score-radar"
               data-max="5"
               data-items-conservative='[
               {% for s in scorecard_list %}
                 {"name": "{{ s.name }}", "score": {{ s.score }}}{% if not loop.last %},{% endif %}
               {% endfor %}
               ]'
               data-items-standard='[
               {% for s in scorecard_list_standard %}
                 {"name": "{{ s.name }}", "score": {{ s.score }}}{% if not loop.last %},{% endif %}
               {% endfor %}
               ]'>
          </div>
        </div>
      </div>
      <div class="scorecard-grid">
        {% for p in pillar_summaries %}
        <div class="scorecard-card"
             style="--pillar-color: {{ p.color }}"
             data-pillar="{{ p.name }}"
             data-score-conservative="{{ scorecard_scores.get(p.name, 5) }}"
             data-score-standard="{{ scorecard_scores_standard.get(p.name, 5) }}">
          <div class="name">{{ p.name }}</div>
          <div class="score-row">
            <span class="score-num">{{ scorecard_scores.get(p.name, 5) }}/5</span>
            <span class="score-label">
              {% set sc = scorecard_scores.get(p.name, 5) %}
              {% if sc == 5 %}Excelente{% elif sc == 4 %}Bueno{% elif sc == 3 %}Aceptable{% elif sc == 2 %}Necesita Mejora{% else %}Cr√≠tico{% endif %}
            </span>
          </div>
          <p class="summary">{{ pillars[p.name].summary }}</p>
        </div>
        {% endfor %}
      </div>
    </div>
    <div id="panel-caf" class="tab-panel">
      <div class="tab-report-content">
        <p>Esta secci√≥n est√° reservada para contenido del <strong>AWS Cloud Adoption Framework (CAF)</strong>. Pr√≥ximamente.</p>
      </div>
    </div>
    <div id="panel-maturity" class="tab-panel">
      {% if security_maturity_html %}
      <div class="tab-report-content">{{ security_maturity_html }}</div>
      {% else %}
      <div class="tab-report-placeholder">
        <p>Ejecute <code>make reports RUN_DIR=...</code> para incluir el Modelo de Madurez en Seguridad de AWS en esta vista.</p>
        <p><a href="https://maturitymodel.security.aws.dev/es/" target="_blank" rel="noopener">Modelo de Madurez en Seguridad de AWS (es)</a></p>
      </div>
      {% endif %}
    </div>
    <div id="panel-executive" class="tab-panel">
      {% if executive_summary_html %}
      <div class="tab-report-content">{{ executive_summary_html }}</div>
      {% else %}
      <div class="tab-report-placeholder">
        <p>Ejecute <code>make reports RUN_DIR=...</code> para incluir el resumen ejecutivo en esta vista.</p>
      </div>
      {% endif %}
    </div>
    <div id="panel-findings" class="tab-panel">
      {% if findings_html %}
      <div class="tab-report-content">{{ findings_html }}</div>
      {% else %}
      <div class="tab-report-placeholder">
        <p>Ejecute <code>make reports RUN_DIR=...</code> para incluir el reporte de hallazgos en esta vista.</p>
      </div>
      {% endif %}
    </div>
    <div id="panel-improvement-plan" class="tab-panel">
      {% if improvement_plan_html %}
      <div class="tab-report-content">{{ improvement_plan_html }}</div>
      {% else %}
      <div class="tab-report-placeholder">
        <p>Ejecute <code>make reports RUN_DIR=...</code> para incluir el Plan de mejoras (Well-Architected Improvement Plan) en esta vista.</p>
      </div>
      {% endif %}
    </div>
    <div id="panel-tagging" class="tab-panel">
      {% if tagging_html %}
      <div class="tab-report-content">{{ tagging_html }}</div>
      {% else %}
      <div class="tab-report-placeholder">
        <p>Ejecute <code>make reports RUN_DIR=...</code> para incluir el reporte de tags por servicio.</p>
        <p>Aseg√∫rate de que la pol√≠tica IAM incluya <code>tag:GetResources</code>, <code>tag:GetTagKeys</code> y <code>tag:GetTagValues</code>.</p>
      </div>
      {% endif %}
    </div>
    <div id="panel-evidence" class="tab-panel">
      <div class="container" style="padding-bottom: 24px;">
        <div class="pillar-cards">
          {% for p in pillar_summaries %}
          <a class="pillar-card" href="#pillar-{{ p.slug }}" style="--pillar-color: {{ p.color }}">
            <span class="pillar-hero-icon">{{ pillar_icons[p.name] }}</span>
            <span class="name">{{ p.name }}</span>
            <span class="badge badge-{{ p.badge_class }}">{{ p.status_label }}</span>
            <p class="summary">{{ p.summary }}</p>
          </a>
          {% endfor %}
        </div>
      </div>
  <nav class="nav-pillars">
    <div class="container">
      {% for p in pillar_summaries %}
      <a href="#pillar-{{ p.slug }}" data-color style="--pillar-color: {{ p.color }}">{{ p.name }}</a>
      {% endfor %}
    </div>
  </nav>

  <main>
    <div class="container">
    {% for p in pillar_summaries %}
    <section id="pillar-{{ p.slug }}" class="section-pillar" style="--pillar-color: {{ p.color }}">
      <div class="pillar-section-icon">{{ pillar_icons[p.name] }}</div>
      <h2>{{ p.name }}</h2>
      <p class="pillar-summary">{{ pillars[p.name].summary }}</p>
      <div class="accordion">
        {% for q in pillars[p.name].well_architected_questions %}
        <details>
          <summary>
            <span class="q-id">{{ q.id }}</span>
            <span>{{ q.question }}</span>
            <span class="badge badge-{{ q.badge_class }}">{{ q.compliance_label }}</span>
          </summary>
          <div class="content">
            <div class="compliance-msg status-{{ q.compliance_class }}">{{ q.compliance.message }}</div>
            {% if q.compliance.detected_services or q.compliance.missing_services %}
            <p><strong>Servicios evaluados</strong></p>
            {% if q.compliance.detected_services %}
            <p class="servicios-list"><strong>Detectados ({{ q.compliance.detected_services|length }}):</strong> {{ q.compliance.detected_services|join(', ') }}</p>
            {% endif %}
            {% if q.compliance.missing_services %}
            <p class="servicios-list missing"><strong>No detectados ({{ q.compliance.missing_services|length }}):</strong> {{ q.compliance.missing_services|join(', ') }}</p>
            {% endif %}
            {% endif %}
            {% if q.related_evidences %}
            <p><strong>Evidencias</strong></p>
            <ul class="evidences">
              {% for ev in q.related_evidences %}
              <li class="ev-{{ ev.status_class }}">
                {% if ev.type == 'finding' %}{{ ev.finding_label }}{% else %}{{ ev.description }}{% endif %}
                {% if ev.gap %}<br><em>Gap: {{ ev.gap }}</em>{% endif %}
              </li>
              {% endfor %}
            </ul>
            {% endif %}
            {% if q.best_practices %}
            <p><strong>Mejores pr√°cticas</strong></p>
            <ul class="practices">
              {% for bp in q.best_practices %}<li>{{ bp.practice }}</li>{% endfor %}
            </ul>
            {% endif %}
          </div>
        </details>
        {% endfor %}
      </div>
    </section>
    {% endfor %}
    </div>
  </main>
    </div>
  </div>

  <footer class="footer">
    <div class="container">AWS Cloud Architecture Diagnostic (ECAD)</div>
  </footer>
  <script>
    (function() {
      var KEY = 'ecad-theme';
      var root = document.documentElement;
      function setTheme(val) {
        root.setAttribute('data-theme', val || 'dark');
        if (typeof localStorage !== 'undefined') try { localStorage.setItem(KEY, val || 'dark'); } catch (e) {}
      }
      function getPreferred() {
        try { return localStorage.getItem(KEY); } catch (e) { return null; }
      }
      function prefersLight() {
        try { return window.matchMedia && window.matchMedia('(prefers-color-scheme: light)').matches; } catch (e) { return false; }
      }
      var stored = getPreferred();
      if (stored) setTheme(stored);
      else if (prefersLight()) setTheme('light');
      else setTheme('dark');
      var btn = document.getElementById('theme-toggle');
      if (btn) btn.addEventListener('click', function() {
        var next = root.getAttribute('data-theme') === 'light' ? 'dark' : 'light';
        setTheme(next);
      });

      // Radar chart en Scorecard
      function renderScoreRadar(mode) {
        var el = document.getElementById('score-radar');
        if (!el) return;
        var raw = el.getAttribute(mode === 'standard' ? 'data-items-standard' : 'data-items-conservative') || '[]';
        var items;
        try {
          items = JSON.parse(raw);
        } catch (e) {
          return;
        }
        if (!items || !items.length) return;
        var max = parseFloat(el.getAttribute('data-max') || '5') || 5;
        var size = 260;
        var cx = size / 2;
        var cy = size / 2;
        var radius = size * 0.35;
        var levels = 5;
        var n = items.length;
        var accent = getComputedStyle(document.documentElement).getPropertyValue('--accent') || '#38bdf8';

        function point(angle, r) {
          return {
            x: cx + r * Math.cos(angle),
            y: cy + r * Math.sin(angle),
          };
        }

        var svgParts = [];
        svgParts.push('<svg viewBox="0 0 ' + size + ' ' + size + '" xmlns="http://www.w3.org/2000/svg">');

        // Grid (pol√≠gonos conc√©ntricos)
        for (var level = 1; level <= levels; level++) {
          var r = (radius * level) / levels;
          var pts = [];
          for (var i = 0; i < n; i++) {
            var angle = -Math.PI / 2 + (2 * Math.PI * i) / n;
            var p = point(angle, r);
            pts.push(p.x.toFixed(1) + ',' + p.y.toFixed(1));
          }
          svgParts.push('<polygon class="score-radar-grid" points="' + pts.join(' ') + '"/>');
        }

        // Ejes y etiquetas
        for (var j = 0; j < n; j++) {
          var a = -Math.PI / 2 + (2 * Math.PI * j) / n;
          var end = point(a, radius);
          svgParts.push('<line class="score-radar-axis" x1="' + cx + '" y1="' + cy + '" x2="' + end.x.toFixed(1) + '" y2="' + end.y.toFixed(1) + '"/>');
          var labelPoint = point(a, radius + 20);
          var name = (items[j].name || '').replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;');
          svgParts.push('<text class="score-radar-label" x="' + labelPoint.x.toFixed(1) + '" y="' + labelPoint.y.toFixed(1) + '" text-anchor="middle">' + name + '</text>');
        }

        // Pol√≠gono de datos
        var dataPts = [];
        for (var k = 0; k < n; k++) {
          var item = items[k];
          var val = Math.max(0, Math.min(max, parseFloat(item.score || 0)));
          var rr = (val / max) * radius;
          var ang = -Math.PI / 2 + (2 * Math.PI * k) / n;
          var dp = point(ang, rr);
          dataPts.push(dp.x.toFixed(1) + ',' + dp.y.toFixed(1));
        }
        svgParts.push('<polygon class="score-radar-polygon" points="' + dataPts.join(' ') + '" style="stroke:' + accent + '; fill:' + accent + ';"/>');

        svgParts.push('</svg>');
        el.innerHTML = svgParts.join('');
      }

      function scoreLabel(score) {
        if (score >= 5) return 'Excelente';
        if (score === 4) return 'Bueno';
        if (score === 3) return 'Aceptable';
        if (score === 2) return 'Necesita Mejora';
        return 'Cr√≠tico';
      }

      function applyScoreMode(mode) {
        var selected = (mode === 'standard') ? 'standard' : 'conservative';
        var avg = selected === 'standard' ? '{{ average_score_standard }}' : '{{ average_score }}';
        var avgEl = document.getElementById('overall-score');
        if (avgEl) avgEl.textContent = avg;

        var standardBtn = document.getElementById('score-mode-standard');
        var conservativeBtn = document.getElementById('score-mode-conservative');
        if (standardBtn && conservativeBtn) {
          standardBtn.classList.toggle('is-active', selected === 'standard');
          conservativeBtn.classList.toggle('is-active', selected === 'conservative');
        }

        var fStd = document.getElementById('score-formula-standard');
        var fCon = document.getElementById('score-formula-conservative');
        if (fStd && fCon) {
          fStd.style.display = selected === 'standard' ? 'block' : 'none';
          fCon.style.display = selected === 'conservative' ? 'block' : 'none';
        }

        var cards = document.querySelectorAll('.scorecard-card');
        cards.forEach(function(card) {
          var scoreRaw = card.getAttribute(selected === 'standard' ? 'data-score-standard' : 'data-score-conservative');
          var score = parseInt(scoreRaw || '0', 10);
          var numEl = card.querySelector('.score-num');
          var labelEl = card.querySelector('.score-label');
          if (numEl) numEl.textContent = score + '/5';
          if (labelEl) labelEl.textContent = scoreLabel(score);
        });

        renderScoreRadar(selected);
        try { localStorage.setItem('ecad-score-mode', selected); } catch (e) {}
      }

      if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', function() {
          var standardBtn = document.getElementById('score-mode-standard');
          var conservativeBtn = document.getElementById('score-mode-conservative');
          if (standardBtn) standardBtn.addEventListener('click', function() { applyScoreMode('standard'); });
          if (conservativeBtn) conservativeBtn.addEventListener('click', function() { applyScoreMode('conservative'); });
          var preferred = 'conservative';
          try { preferred = localStorage.getItem('ecad-score-mode') || 'conservative'; } catch (e) {}
          applyScoreMode(preferred);
        });
      } else {
        var standardBtn = document.getElementById('score-mode-standard');
        var conservativeBtn = document.getElementById('score-mode-conservative');
        if (standardBtn) standardBtn.addEventListener('click', function() { applyScoreMode('standard'); });
        if (conservativeBtn) conservativeBtn.addEventListener('click', function() { applyScoreMode('conservative'); });
        var preferred = 'conservative';
        try { preferred = localStorage.getItem('ecad-score-mode') || 'conservative'; } catch (e) {}
        applyScoreMode(preferred);
      }
    })();
  </script>
</body>
</html>
